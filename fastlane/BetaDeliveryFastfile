###################### PRIVATE LANES #########################

desc "Test external Fastfile import"
private_lane :beta_delivery_laod_test_lane do

  lane_name = lane_context[SharedValues::LANE_NAME]
  puts "Testing #{lane_name}"
  puts "BETA DELIVERY FASTFILE HERE ðŸ‘‹!"
  puts "Test succeeded âœ…"

end

desc 'Submits a newly packaged app to to Fabric'
private_lane :submit_to_fabric do |options|

  # look for CRASHLITYCS_APIKEY and CRASHLYTICS_BUILDSECRET set into our project Build Settings
  crashlytics_apikey = ''
  crashlytics_buildsecret = ''
  project = Xcodeproj::Project.open("../#{options[:xcodeproj_path]}")
  project.targets.each do |mtarget|
      if mtarget.name == options[:scheme_name]
          mtarget.build_configurations.each do |mbuild|
              if mbuild.name == options[:build_configuration]
                  crashlytics_apikey =  mbuild.build_settings['CRASHLYTICS_APIKEY'].chomp
                  crashlytics_buildsecret =  mbuild.build_settings['CRASHLYTICS_BUILDSECRET'].chomp
              end
          end
      end
  end

  crashlytics(
    crashlytics_path: './Pods/Crashlytics/submit', # path to your 'Crashlytics.framework'
    api_token: crashlytics_apikey,
    build_secret: crashlytics_buildsecret,
    groups: ENV['CRASHLYTICS_GROUP'],
    notes: "#{options[:build_configuration]} - #{options[:release_notes]}"
  )

end

################### END PRIVATE LANES #######################
